<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>作業8</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <script src="js/bootstrap.bundle.min.js"></script>
    <style>
        input{
            width: 60px;
            margin-right: 10px;
        }
        [id^="saleP"]{
            margin-bottom: 10px;
        }
        svg{
            border: 1px solid gray;
        }
        #axisX,#axisY{
            stroke: #0000ff;
            stroke-width: 2px;
        }
        #poly0, #txt0{
            stroke: #f2575f;
        }
        #poly1, #txt1{
            stroke: #639ee7;
        }
        #poly2, #txt2{
            stroke: #6ce069;
        }
        #poly3, #txt3{
            stroke: #a89faa;
        }
        [id^="poly"] {
            fill: none;
            stroke-width: 2px;
        }
        [id^="txt"]{
            font-size: 14px;
            font-family: '微軟正黑體';
        }
    </style>
    <script>
        var svgWidth = 500, svgHeight = 500, padLeft = 20, padTop = 10;
    </script>
</head>
<body onload="init()">
    <div id="saleP0"></div>
    <div id="saleP1"></div>
    <div id="saleP2"></div>
    <div id="saleP3"></div>
    <div id="areaLine">
        <svg id="svgLine">
            <line x1="0" y1="0" x2="0" y2="0" id="axisX"></line>
            <line x1="0" y1="0" x2="0" y2="0" id="axisY"></line>
            <polyline points="0,0" id="poly0"></polyline>
            <polyline points="0,0" id="poly1"></polyline>
            <polyline points="0,0" id="poly2"></polyline>
            <polyline points="0,0" id="poly3"></polyline>
            <text x="0" y="0" id="txt0"></text>
            <text x="0" y="0" id="txt1"></text>
            <text x="0" y="0" id="txt2"></text>
            <text x="0" y="0" id="txt3"></text>

        </svg>
    </div>
    <div id="areaRect"></div>
    <div id="areaCirc"></div>
    <script>

        var domSvgLine = document.getElementById('svgLine');
        var domSvgRect = document.getElementById('svgRect');
        var domSvgCirc = document.getElementById('svgCirc');
        var domAxisX = document.getElementById('axisX');
        var domAxisY = document.getElementById('axisY');
        var poly0 = document.getElementById('poly0');
        var poly1 = document.getElementById('poly1');
        var poly2 = document.getElementById('poly2');
        var poly3 = document.getElementById('poly3');

        var saleData = [];

        function init() {
            initialUI();
            initialData();
            drawAll();
        }

        function initialUI() {
            let salesName = ['甲', '乙', '丙', '丁'];
            for (let i = 0; i < 4; i++) {
                document.getElementById('txt' + i).textContent = salesName[i];
                let insertString = `<h3>${salesName[i]}</h3>`;
                for (let j = 0; j < 4; j++) {
                    let str = `第${j+1}季：`;
                    str += `<input type="number" id="sale${i}${j}" />`;
                    insertString += str;
                }
                document.getElementById('saleP' + i).innerHTML = insertString;
            }
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    document.getElementById(`sale${i}${j}`).addEventListener('change', drawAll);
                }
            }

        }
        function initialData() {
            let initData = [[10,13,8,15],[12,19,11,14],[14,11,10,7],[8,10,16,16]];
            for (let i = 0; i < 4; i++) {
                let pSale = initData[i];
                for (let j = 0; j < 4; j++) {
                    document.getElementById(`sale${i}${j}`).value = pSale[j];
                }
            }
        }

        function drawAll() {
            for (let i = 0; i < 4; i++) {
                saleData[i] = [];
                for (let j = 0; j < 4; j++) {
                    saleData[i][j] = parseInt(document.getElementById(`sale${i}${j}`).value);
                }
            }
            drawLine();
            drawRect();
            drawCirc();
        }

        function drawLine() {
            domSvgLine.style.width = svgWidth;
            domSvgLine.style.height = svgHeight * 2 / 3;

            let totalWidth = svgWidth - padLeft * 2;
            let totalHeight = svgHeight * 2 / 3 - padTop * 2;
            let distance = totalWidth / 4 ;

            let min = saleData[0][0], max = min;
            for (let seq of saleData) {
                for (let item of seq) {
                    if (min > item) {
                        min = item;
                    }
                    if (max < item) {
                        max = item;
                    }
                }
            }

            domAxisX.setAttribute('x1', padLeft);
            domAxisX.setAttribute('y1', totalHeight - padTop);
            domAxisX.setAttribute('x2', totalWidth - padLeft);
            domAxisX.setAttribute('y2', totalHeight - padTop);
            domAxisY.setAttribute('x1', padLeft);
            domAxisY.setAttribute('y1', totalHeight - padTop);
            domAxisY.setAttribute('x2', padLeft);
            domAxisY.setAttribute('y2', padTop);

            for (let i = 0; i < 4; i++) {
                let str = [];
                for (let j = 0; j < 4; j++) {
                    let ratio = (saleData[i][j] - min) / (max - min);
                    str.push(`${padLeft * 2 + distance * j},${(totalHeight - padTop * 4) * (1 - ratio) + padTop}`);
                    if (j == 4 - 1) {
                        let domTxt = document.getElementById('txt' + i);
                        domTxt.setAttribute('x', padLeft * 3 + distance * j);
                        domTxt.setAttribute('y', (totalHeight - padTop * 4) * (1 - ratio) + padTop);
                    }
                }
                document.getElementById('poly' + i).setAttribute('points', str.join(' '));
            }
        }

        function drawRect() {

        }
        function drawCirc() {

        }
    </script>
</body>
</html>